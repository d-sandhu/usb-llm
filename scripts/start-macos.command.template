#!/usr/bin/env bash
set -euo pipefail
cd "$(dirname "$0")"

# --- Autostart configuration ---
export USBLLM_AUTOSTART=1
export USBLLM_LLAMA_BIN="$(pwd)/llama/llama-server"

# Use a registry ID (see models/registry.json and docs/MODELS.md)
export USBLLM_MODEL_ID="starter-phi3-mini-q4_k_m"
export USBLLM_MODELS_DIR="$(pwd)/models"

# Optional tuning (adjust as needed)
export USBLLM_THREADS=6
export USBLLM_CTX_SIZE=4096
export USBLLM_LOG_DISABLE=1

# Ensure binaries are executable (macOS)
chmod +x "./usb-llm-launcher" || true
chmod +x "./llama/llama-server" || true

# Launch
./usb-llm-launcher